<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard ¬∑ Smart Health Tracker</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>ü©∫ Smart Health Tracker</h1>
    <p class="header-sub">Track your vitals, set reminders and stay consistent.</p>
  </header>

  <main class="dashboard">
    <!-- LEFT: Add Record + Past Records -->
    <section class="card left-card">
      <h2>Add New Record</h2>

      <form action="{{ url_for('add_record') }}" method="POST" class="form-grid">
        <div class="form-group full-width">
          <label for="date">Date</label>
          <input id="date" name="date" type="date" required>
        </div>

        <div class="form-group">
          <label for="weight">Weight (kg)</label>
          <input id="weight" name="weight" type="number" step="0.1" placeholder="e.g., 70" required>
        </div>

        <div class="form-group">
          <label for="bp">Blood Pressure</label>
          <input id="bp" name="blood_pressure" type="text" placeholder="e.g., 120/80" required>
        </div>

        <div class="form-group full-width">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" rows="2" placeholder="Add observations (optional)"></textarea>
        </div>

        <div class="form-group full-width">
          <button type="submit" class="btn-primary">Save Record</button>
        </div>
      </form>

      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="flash {{ category }}">
              {% if category == 'warning' %}
                <img src="{{ url_for('static', filename='bp-high.png') }}" alt="alert" class="flash-img">
              {% endif %}
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <h3>üìä Past Records</h3>
      {% if records %}
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Weight</th>
              <th>BP</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            {% for record in records %}
              <tr>
                <td>{{ record.date }}</td>
                <td>{{ record.weight }}</td>
                <td>{{ record.blood_pressure }}</td>
                <td>{{ record.notes }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="empty">No records yet.</p>
      {% endif %}
    </section>

    <!-- RIGHT: Reminders display + form -->
    <section class="card right-card">
      <h2>Active Reminders</h2>

      {% if reminders %}
        <table>
          <thead>
            <tr>
              <th>Frequency</th>
              <th>Details</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for r in reminders %}
            <tr>
              <td>{{ r.frequency|capitalize }}</td>
              <td>
                {{ r.description or '‚Äî' }}
                {% if r.frequency == 'weekly' and r.day %}{% raw %} <div class="muted">({{ r.day }})</div>{% endraw %}{% endif %}
                {% if r.frequency == 'monthly' and r.date %}{% raw %} <div class="muted">({{ r.date }})</div>{% endraw %}{% endif %}
                {% if r.snoozed_until %}
                  <div class="muted">Snoozed until: {{ r.snoozed_until.split('T')[0] }} {{ r.snoozed_until.split('T')[1].split('.')[0] }}</div>
                {% endif %}
                {% if r.alert %}<div class="small-alert">üîî Pending: Please add your record</div>{% endif %}
              </td>
              <td>
                {% if r.alert %}
                  <a href="{{ url_for('snooze', i=loop.index0) }}" class="btn-snooze">üò¥ Snooze</a>
                {% endif %}
                <a href="{{ url_for('delete_reminder', i=loop.index0) }}" class="btn-delete">üóëÔ∏è</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="empty">No active reminders.</p>
      {% endif %}

      <hr style="margin:18px 0; border:none; border-top:1px solid #e6eef8;">

      <h3>‚ûï Set a New Reminder</h3>
      <form action="{{ url_for('set_reminder') }}" method="POST" class="form-grid" id="reminderForm">
        <div class="form-group full-width">
          <label for="frequency">Frequency</label>
          <select id="frequency" name="frequency" required onchange="handleReminderChange()">
            <option value="">Select Frequency</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>

        <div id="daySelect" class="form-group full-width" style="display:none;">
          <label for="day">Day (Weekly)</label>
          <select id="day" name="day">
            <option value="">Choose day</option>
            <option>Monday</option><option>Tuesday</option><option>Wednesday</option>
            <option>Thursday</option><option>Friday</option><option>Saturday</option><option>Sunday</option>
          </select>
        </div>

        <div id="dateSelect" class="form-group full-width" style="display:none;">
          <label for="month_date">Date (Monthly)</label>
          <input id="month_date" name="month_date" type="number" min="1" max="31" placeholder="1‚Äì31">
        </div>

        <div class="form-group full-width">
          <label for="description">Description</label>
          <textarea id="description" name="description" rows="2" placeholder="e.g., Check BP & sugar"></textarea>
        </div>

        <div class="form-group full-width">
          <button type="submit" class="btn-secondary">Set Reminder</button>
        </div>
      </form>
    </section>
  </main>

  <footer>
    <p>Made with ‚ù§Ô∏è using Flask & Python</p>
  </footer>

  <script>
    function handleReminderChange() {
      const freq = document.getElementById('frequency').value;
      document.getElementById('daySelect').style.display = (freq === 'weekly') ? 'block' : 'none';
      document.getElementById('dateSelect').style.display = (freq === 'monthly') ? 'block' : 'none';
    }

    // Keep the reminder fields correct when the page loads (if server preselected something)
    (function initReminderVisibility(){
      try {
        handleReminderChange();
      } catch(e) { /* ignore */ }
    })();
  </script>
</body>
</html>
